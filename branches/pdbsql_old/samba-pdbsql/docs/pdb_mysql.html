<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Chapter 10. Account Information Databases</title>
<link rel="stylesheet" href="samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.68.1">
</head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
</pre><p>
		<div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2560516"></a>MySQL</h3></div></div></div><p>
	<a class="indexterm" name="id2560524"></a>
<a class="indexterm" name="id2560533"></a>
	Every so often someone comes along with what seems (to them) like a great new idea. Storing user accounts
	in an SQL backend is one of them. Those who want to do this are in the best position to know what the
	specific benefits are to them. This may sound like a cop-out, but in truth we cannot document
	every little detail of why certain things of marginal utility to the bulk of Samba users might make sense
	to the rest. In any case, the following instructions should help the determined SQL user to implement a
	working system. These account storage methods are not actively maintained by the Samba Team.
	</p><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2560551"></a>Creating the Database</h4></div></div></div><p>
<a class="indexterm" name="id2560559"></a>
			You can set up your own table and specify the field names to pdb_mysql (see
			<a href="passdb.html#moremysqlpdbe" title="Table 10.7. MySQL field names for MySQL passdb backend">MySQL field names for MySQL passdb backend</a> for
			the column names) or use the default table. The file
			<code class="filename">examples/pdb/mysql/mysql.dump</code> contains the correct queries to
			create the required tables. Use the command:
</p><pre class="screen">
<code class="prompt">root# </code><strong class="userinput"><code>mysql -u<em class="replaceable"><code>username</code></em> -h<em class="replaceable"><code>hostname</code></em> -p<em class="replaceable"><code>password</code></em> \
	<em class="replaceable"><code>databasename</code></em> &lt; <code class="filename">/path/to/samba/examples/pdb/mysql/mysql.dump</code></code></strong>
</pre><p>
			</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2560623"></a>Configuring</h4></div></div></div><p>This plug-in lacks some good documentation, but here is some brief information. Add the following to the
			<a class="indexterm" name="id2560633"></a>passdb backend variable in your <code class="filename">smb.conf</code>:
</p><table class="simplelist" border="0" summary="Simple list"><tr><td><a class="indexterm" name="id2560652"></a><em class="parameter"><code>passdb backend = [other-plugins] mysql:identifier [other-plugins]</code></em></td></tr></table><p>
			</p><p>The identifier can be any string you like, as long as it does not collide with 
			the identifiers of other plugins or other instances of pdb_mysql. If you 
			specify multiple pdb_mysql.so entries in <a class="indexterm" name="id2560672"></a>passdb backend, you also need to 
			use different identifiers.
			</p><p>
			Additional options can be given through the <code class="filename">smb.conf</code> file in the <em class="parameter"><code>[global]</code></em> section.
			Refer to <a href="passdb.html#mysqlpbe" title="Table 10.6. Basic smb.conf Options for MySQL passdb Backend">Basic smb.conf Options for MySQL passdb Backend</a>.
			</p><div class="table"><a name="mysqlpbe"></a><p class="title"><b>Table 10.6. Basic smb.conf Options for MySQL passdb Backend</b></p><table summary="Basic smb.conf Options for MySQL passdb Backend" border="1"><colgroup><col align="left"><col align="justify"></colgroup><thead><tr><th align="left">Field</th><th align="justify">Contents</th></tr></thead><tbody><tr><td align="left">mysql host</td><td align="justify">Host name, defaults to `localhost'</td></tr><tr><td align="left">mysql password</td><td align="justify"> </td></tr><tr><td align="left">mysql user</td><td align="justify">Defaults to `samba'</td></tr><tr><td align="left">mysql database</td><td align="justify">Defaults to `samba'</td></tr><tr><td align="left">mysql port</td><td align="justify">Defaults to 3306</td></tr><tr><td align="left">table</td><td align="justify">Name of the table containing the users</td></tr></tbody></table></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
			Since the password for the MySQL user is stored in the <code class="filename">smb.conf</code> file, you should make the <code class="filename">smb.conf</code> file 
			readable only to the user who runs Samba. This is considered a security bug and will soon be fixed.
			</p></div><p>Names of the columns are given in <a href="passdb.html#moremysqlpdbe" title="Table 10.7. MySQL field names for MySQL passdb backend">MySQL field names for MySQL
			passdb backend</a>.  The default column names can be found in the example table dump.
			 </p><p>
			</p><div class="table"><a name="moremysqlpdbe"></a><p class="title"><b>Table 10.7. MySQL field names for MySQL passdb backend</b></p><table summary="MySQL field names for MySQL passdb backend" border="1"><colgroup><col align="left"><col align="left"><col align="justify"></colgroup><thead><tr><th align="justify">Field</th><th align="justify">Type</th><th align="justify">Contents</th></tr></thead><tbody><tr><td align="justify">logon time column</td><td align="justify">int(9)</td><td align="justify">UNIX timestamp of last logon of user</td></tr><tr><td align="justify">logoff time column</td><td align="justify">int(9)</td><td align="justify">UNIX timestamp of last logoff of user</td></tr><tr><td align="justify">kickoff time column</td><td align="justify">int(9)</td><td align="justify">UNIX timestamp of moment user should be kicked off workstation (not enforced)</td></tr><tr><td align="justify">pass last set time column</td><td align="justify">int(9)</td><td align="justify">UNIX timestamp of moment password was last set</td></tr><tr><td align="justify">pass can change time column</td><td align="justify">int(9)</td><td align="justify">UNIX timestamp of moment from which password can be changed</td></tr><tr><td align="justify">pass must change time column</td><td align="justify">int(9)</td><td align="justify">UNIX timestamp of moment on which password must be changed</td></tr><tr><td align="justify">username column</td><td align="justify">varchar(255)</td><td align="justify">UNIX username</td></tr><tr><td align="justify">domain column</td><td align="justify">varchar(255)</td><td align="justify">NT domain user belongs to</td></tr><tr><td align="justify">nt username column</td><td align="justify">varchar(255)</td><td align="justify">NT username</td></tr><tr><td align="justify">fullname column</td><td align="justify">varchar(255)</td><td align="justify">Full name of user</td></tr><tr><td align="justify">home dir column</td><td align="justify">varchar(255)</td><td align="justify">UNIX homedir path (equivalent of the <a class="indexterm" name="id2560984"></a>logon home parameter.</td></tr><tr><td align="justify">dir drive column</td><td align="justify">varchar(2)</td><td align="justify">Directory drive path (e.g., &#8220;<span class="quote">H:</span>&#8221;)</td></tr><tr><td align="justify">logon script column</td><td align="justify">varchar(255)</td><td align="justify">Batch file to run on client side when logging on</td></tr><tr><td align="justify">profile path column</td><td align="justify">varchar(255)</td><td align="justify">Path of profile</td></tr><tr><td align="justify">acct desc column</td><td align="justify">varchar(255)</td><td align="justify">Some ASCII NT user data</td></tr><tr><td align="justify">workstations column</td><td align="justify">varchar(255)</td><td align="justify">Workstations user can logon to (or NULL for all)</td></tr><tr><td align="justify">unknown string column</td><td align="justify">varchar(255)</td><td align="justify">Unknown string</td></tr><tr><td align="justify">munged dial column</td><td align="justify">varchar(255)</td><td align="justify">Unknown</td></tr><tr><td align="justify">user sid column</td><td align="justify">varchar(255)</td><td align="justify">NT user SID</td></tr><tr><td align="justify">group sid column</td><td align="justify">varchar(255)</td><td align="justify">NT group SID</td></tr><tr><td align="justify">lanman pass column</td><td align="justify">varchar(255)</td><td align="justify">Encrypted lanman password</td></tr><tr><td align="justify">nt pass column</td><td align="justify">varchar(255)</td><td align="justify">Encrypted nt passwd</td></tr><tr><td align="justify">plain pass column</td><td align="justify">varchar(255)</td><td align="justify">Plaintext password</td></tr><tr><td align="justify">acct ctrl column</td><td align="justify">int(9)</td><td align="justify">NT user data</td></tr><tr><td align="justify">unknown 3 column</td><td align="justify">int(9)</td><td align="justify">Unknown</td></tr><tr><td align="justify">logon divs column</td><td align="justify">int(9)</td><td align="justify">Unknown</td></tr><tr><td align="justify">hours len column</td><td align="justify">int(9)</td><td align="justify">Unknown</td></tr><tr><td align="justify">bad password count column</td><td align="justify">int(5)</td><td align="justify">Number of failed password tries before disabling an account</td></tr><tr><td align="justify">logon count column</td><td align="justify">int(5)</td><td align="justify">Number of logon attempts</td></tr><tr><td align="justify">unknown 6 column</td><td align="justify">int(9)</td><td align="justify">Unknown</td></tr></tbody></table></div><p>
		</p><p>
			You can put a colon (:) after the name of each column, which 
			should specify the column to update when updating the table. You can also specify nothing behind the colon, in which case the field data will not be updated. Setting a column name to <em class="parameter"><code>NULL</code></em> means the field should not be used.
			</p><p><a href="passdb.html#mysqlsam" title="Example 10.3. Example Configuration for the MySQL passdb Backend">An example configuration</a> is shown in <a href="passdb.html#mysqlsam" title="Example 10.3. Example Configuration for the MySQL passdb Backend">Example Configuration for the MySQL passdb Backend</a>.
			</p><div class="example"><a name="mysqlsam"></a><p class="title"><b>Example 10.3. Example Configuration for the MySQL passdb Backend</b></p><table class="simplelist" border="0" summary="Simple list"><tr><td> </td></tr><tr><td><em class="parameter"><code>[global]</code></em></td></tr><tr><td><a class="indexterm" name="id2561242"></a><em class="parameter"><code>passdb backend = mysql:foo</code></em></td></tr><tr><td><a class="indexterm" name="id2561255"></a><em class="parameter"><code>foo:mysql user = samba</code></em></td></tr><tr><td><a class="indexterm" name="id2561268"></a><em class="parameter"><code>foo:mysql password = abmas</code></em></td></tr><tr><td><a class="indexterm" name="id2561280"></a><em class="parameter"><code>foo:mysql database = samba</code></em></td></tr><tr><td># domain name is static and can't be changed</td></tr><tr><td><a class="indexterm" name="id2561298"></a><em class="parameter"><code>foo:domain column = 'MYWORKGROUP':</code></em></td></tr><tr><td># The fullname column comes from several other columns</td></tr><tr><td><a class="indexterm" name="id2561315"></a><em class="parameter"><code>foo:fullname column = CONCAT(firstname,' ',surname):</code></em></td></tr><tr><td># Samba should never write to the password columns</td></tr><tr><td><a class="indexterm" name="id2561332"></a><em class="parameter"><code>foo:lanman pass column = lm_pass:</code></em></td></tr><tr><td><a class="indexterm" name="id2561346"></a><em class="parameter"><code>foo:nt pass column = nt_pass:</code></em></td></tr><tr><td># The unknown 3 column is not stored</td></tr><tr><td><a class="indexterm" name="id2561363"></a><em class="parameter"><code>foo:unknown 3 column = NULL</code></em></td></tr></table></div></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2561378"></a>Using Plaintext Passwords or Encrypted Password</h4></div></div></div><p>
<a class="indexterm" name="id2561386"></a>
			I strongly discourage the use of plaintext passwords; however, you can use them.
			</p><p>
<a class="indexterm" name="id2561398"></a>
			If you would like to use plaintext passwords, set
			`identifier:lanman pass column' and `identifier:nt pass column' to
			`NULL' (without the quotes) and `identifier:plain pass column' to the
			name of the column containing the plaintext passwords. 
			</p><p>
			If you use encrypted passwords, set the 'identifier:plain pass
			column' to 'NULL' (without the quotes). This is the default.
			</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2561417"></a>Getting Non-Column Data from the Table</h4></div></div></div><p>
			It is possible to have not all data in the database by making some "constant."
			</p><p>
			For example, you can set `identifier:fullname column' to
			something like <span><strong class="command">CONCAT(Firstname,' ',Surname)</strong></span>
			</p><p>
			Or, set `identifier:workstations column' to:
			<span><strong class="command">NULL</strong></span></p>.

			<p>See the MySQL documentation for more language constructs.</p></div></div>
	</p></div></div></div>
	</body></html>
